# See: https://docs.github.com/en/actions/writing-workflows
---
name: Release

on:
  push:

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      # 1) Bring in MSYS2 and install the Mingw-w64 Perl + build tools
      - name: Setup MSYS2 toolchain
        uses: msys2/setup-msys2@v2
        with:
          update: true
          install: >
            mingw-w64-x86_64-toolchain
            mingw-w64-x86_64-perl
            mingw-w64-x86_64-pkg-config
            make

      # 2) Ensure the MSYS2 Perl is first in PATH
      - name: Prepend MSYS2 to PATH
        run: echo "C:\msys64\mingw64\bin" >> $Env:GITHUB_PATH

      # 3) Build with the vendored OpenSSL feature as before
      - name: Build (vendored OpenSSL)
        uses: asimov-platform/build-rust-action@v3
        with:
          target: x86_64-pc-windows-gnu
          artifact-name: asimov-dataset-cli
          artifact-prefix: release
          binary-name: asimov-dataset-cli
          binary-extension: exe
          rust-toolchain: 1.85.0
